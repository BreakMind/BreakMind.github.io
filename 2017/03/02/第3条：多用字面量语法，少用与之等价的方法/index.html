<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第3条：多用字面量语法，少用与之等价的方法 | Talk is cheap, show me the code.</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="编写Objective-C程序时，总会用到某几个类，它们属于Foundation框架。虽然从技术上来说，不用Foundation框架也能写出Objective-C代码，但实际上却经常要用到此框架。这几个类是NSString、NSNumber、NSArray、NSDictionary。从类名上即可看出各自所表示的数据结构。
Objective-C以语法繁杂而著称。事实上的确是这样。不过，从Objec">
<meta property="og:type" content="article">
<meta property="og:title" content="第3条：多用字面量语法，少用与之等价的方法">
<meta property="og:url" content="http://BreakMind.github.io/2017/03/02/第3条：多用字面量语法，少用与之等价的方法/index.html">
<meta property="og:site_name" content="Talk is cheap, show me the code.">
<meta property="og:description" content="编写Objective-C程序时，总会用到某几个类，它们属于Foundation框架。虽然从技术上来说，不用Foundation框架也能写出Objective-C代码，但实际上却经常要用到此框架。这几个类是NSString、NSNumber、NSArray、NSDictionary。从类名上即可看出各自所表示的数据结构。
Objective-C以语法繁杂而著称。事实上的确是这样。不过，从Objec">
<meta property="og:updated_time" content="2017-03-02T15:39:46.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="第3条：多用字面量语法，少用与之等价的方法">
<meta name="twitter:description" content="编写Objective-C程序时，总会用到某几个类，它们属于Foundation框架。虽然从技术上来说，不用Foundation框架也能写出Objective-C代码，但实际上却经常要用到此框架。这几个类是NSString、NSNumber、NSArray、NSDictionary。从类名上即可看出各自所表示的数据结构。
Objective-C以语法繁杂而著称。事实上的确是这样。不过，从Objec">
  
    <link rel="alternate" href="/atom.xml" title="Talk is cheap, show me the code." type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Talk is cheap, show me the code.</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">主页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/">个人简介</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://BreakMind.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-第3条：多用字面量语法，少用与之等价的方法" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/02/第3条：多用字面量语法，少用与之等价的方法/" class="article-date">
  <time datetime="2017-03-02T06:00:16.000Z" itemprop="datePublished">2017-03-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IOS-编写高质量代码/">IOS-编写高质量代码</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      第3条：多用字面量语法，少用与之等价的方法
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>编写Objective-C程序时，总会用到某几个类，它们属于Foundation框架。虽然从技术上来说，不用Foundation框架也能写出Objective-C代码，但实际上却经常要用到此框架。这几个类是NSString、NSNumber、NSArray、NSDictionary。从类名上即可看出各自所表示的数据结构。</p>
<p>Objective-C以语法繁杂而著称。事实上的确是这样。不过，从Objective-C 1.0起，有一种非常简单的方式能创建NSString对象。这就是“字符串字面量”（string literal），其语法如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSString *someString = @&quot;Effective Objective-C 2.0&quot;;</div></pre></td></tr></table></figure></p>
<p>如果不用这种语法的花，就要以常见的alloc及init方法来分配并初始化NSString对象了。在版本较新的编译器中，也能用这种字面量语法来声明NSNumber、NSArray、NSDictionary类的实例。使用字面量语法（literal syntax）可以缩减源代码长度，使其更为易读。</p>
<h2 id="字面数值"><a href="#字面数值" class="headerlink" title="字面数值"></a>字面数值</h2><p>有时需要把整数、浮点数、布尔值封入Objective-C对象中。这种情况下可以用NSNumber类，该类可以处理多种类型的数值。若是不用字面量，那么就需要按下述方式创建实例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSNumber *someNumber = [NSNumber numberWithInt:1];</div></pre></td></tr></table></figure></p>
<p>上面这行代码创建了一个数字，将其值设为整数1。然而使用字面量能令代码更为整洁：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSNumber *someNumber = @1;</div></pre></td></tr></table></figure></p>
<p>大家可以看到，字面量语法更为精简。不过它还有很多好处。能够以NSNumber实例表示的所有数据类型都可使用该语法。例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">NSNumber *intNumber = @1;</div><div class="line">NSNumber *floatNumber = @2.5f;</div><div class="line">NSNumber *doubleNumber = @3.14159;</div><div class="line">NSNumber *boolNumber = @YES;</div><div class="line">NSNumber *charNumber = @&apos;a&apos;;</div></pre></td></tr></table></figure></p>
<p>字面量语法也适用于下述表达式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">int x = 5;</div><div class="line">float y = 6.23f;</div><div class="line">NSNumber *expressionNumber = @(x * y);</div></pre></td></tr></table></figure></p>
<p>以字面量来表示数值十分有用。这样走可以令NSNumber对象变得整洁，因为声明中只包含数值，而没有多余的语法成分。</p>
<h2 id="字面量数组"><a href="#字面量数组" class="headerlink" title="字面量数组"></a>字面量数组</h2><p>数组是常用的数据结构。如果不使用字面量语法，那么就要这样来创建数组：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSArray *animals = [NSArray arrayWithObjects:@&quot;cat&quot;, @&quot;dog&quot;, @&quot;mouse&quot;, @&quot;badger&quot;, nil];</div></pre></td></tr></table></figure></p>
<p>使用字面量语法来创建则是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSArray *animal = @[@&quot;cat&quot;, @&quot;dog&quot;, @&quot;mouse&quot;, @&quot;badger&quot;, nil];</div></pre></td></tr></table></figure></p>
<p>上面这种做法不仅简单，而且还利于操作数组。数组的常见操作就是取某个下标所对应的对象，这用字面量来做更为容易。如果不用字面量，那么通常会用“objectAtIndex:”方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSString *dog = [animals objectiveAtIndex:1];</div></pre></td></tr></table></figure></p>
<p>若使用字面量，则是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSString *dog = animal[1];</div></pre></td></tr></table></figure></p>
<p>这也叫做“取下标”操作（subscripting），与使用字面量语法的其他情况一样，这种方式也更为简洁、更易理解，而且与其他语言中依下标来访问数组元素时所用的语法类似。<br>不过用字面量语法创建数组时要注意，若数组元素对象中有nil，则会抛出异常，因为字面量语法实际上只是一种“语法糖”（syntactic sugar），其效果等于是先创建了一个数组，然后把方括号内的所有对象都加到这个数组中。抛出的异常会使这样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">*** Terminating app due to uncaught exception</div><div class="line">&apos;NSInvalidArgumentException&apos;,reason:&apos;***</div><div class="line">-[__NSPlaceholderArray initWithObjects:count:]: attempt to insert nil object from objects[0]&apos;</div></pre></td></tr></table></figure></p>
<p>在改用字面量语法来创建数组时就会遇到这个问题。下面这段代码分别以两种语法创建数组：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">id object1 = /* ... */;</div><div class="line">id object2 = /* ... */;</div><div class="line">id object3 = /* ... */;</div><div class="line"></div><div class="line">NSArray *arrayA = [NSArray array WithObjects:object1, object2, object3, nil];</div><div class="line">NSArray *arrayB = @[object1, object2, object3];</div></pre></td></tr></table></figure></p>
<p>大家想想：如果object1与object3都指向了有效的Objective—C对象，而object2是nil，那么会出现什么情况呢？按字面量语法创建数组arrayB时会抛出异常。arrayA虽然能创建出来，但是其中却只含有object1一个对象。原因在于，”arrayWithObjects:“方法会一次处理各个参数，直到发现nil为止，由于object2是nil，所以该方法会提前结束。<br>这个微妙的差别表明，使用字面量语法更为安全。抛出异常令应用程序终止执行，这比创建好数组之后发现元素个数少了要好。向数组中插入nil通常说明程序有错，而通过异常可以更快地发现这个错误。</p>
<h2 id="字面量字典"><a href="#字面量字典" class="headerlink" title="字面量字典"></a>字面量字典</h2><p>”字典“（Dictionary）是一种影射型数据结构，可想起中添加键值对。与数组一样，Objective-C代码也经常用到字典。其创建方式如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">NSDictionary *personData = [NSDictionarydictionary WithObjectsAndKeys:</div><div class="line">	@&quot;Matt&quot;, @&quot;firstName&quot;,</div><div class="line">	@&quot;Galloway&quot;, @&quot;lastName&quot;,</div><div class="line">	@&quot;NSNumber numberWithInt:28&quot;, @&quot;age&quot;,</div><div class="line">];</div></pre></td></tr></table></figure></p>
<p>这样写令人困惑，因为其顺序是&lt;对象&gt;，&lt;键&gt;，&lt;对象&gt;，&lt;键&gt;。这与通常理解的顺序相反，我们一般认为是把”键“映射到”对象“。因此，这种写法不容易读懂。如果改用字面量语法，就清晰多了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">NSDictionary *personData = @&#123;</div><div class="line">	@&quot;firstName&quot;:@&quot;Matt&quot;,</div><div class="line">	@&quot;lastName&quot;:@&quot;Galloway&quot;,</div><div class="line">	@&quot;age&quot;:@28&#125;;</div></pre></td></tr></table></figure></p>
<p>上面这种写法更简明，而且键出现在对象之前，理解起来较顺畅。此范例代码还说明了使用字面量数值的好处。字典中的对象和键必须都是Objective-C对象，所以不能把整数直接放进去，而要将其封装在NSNumber实例中才行。使用字面量语法很容易就能做到这一点，只需给数字前加一个@字符即可。</p>
<p>与数组一样，用字面量语法创建字典时也有个问题，那就是一旦有值为nil，便会抛出异常。不过基于同样的原因，这也是个好事。加入在创建字典时不小心用了空值对象，那么”dictionaryWithObjectsAndKeys:“方法就会在首个nil之前停下来，并抛出异常，这有助于查错。</p>
<p>字典也可以像数组那样用字面量语法访问。按照特定键访问其值得传统做法是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSString *lastName = [personData objectForKey:@&quot;lastName&quot;];</div></pre></td></tr></table></figure></p>
<p>与之等效的字面量语法则是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSString *lastName = personData[@&quot;lastName&quot;];</div></pre></td></tr></table></figure></p>
<p>这样写也省去了冗赘的语法，令此行代码简单易读。</p>
<h2 id="可变数组与字典"><a href="#可变数组与字典" class="headerlink" title="可变数组与字典"></a>可变数组与字典</h2><p>通过取下标操作，可以访问数组中某个下标或字典中某个键所对应的元素。如果数组与字典对象是可变的（mutable），那么也能通过下标修改其中的元素值。修改可变元素与字典内容的标准做法是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[mutableArray replaceObjectAtIndex:1 withObject:@&quot;dog&quot;];</div><div class="line">[mutableDictionary setObject:@&quot;Galloway&quot; forKey:@&quot;lastName&quot;];</div></pre></td></tr></table></figure></p>
<p>若换用取下标操作来写，则是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mutableArray[1] = @&quot;dog&quot;;</div><div class="line">mutableDictionary[@&quot;lastName&quot;] = @&quot;Galloway&quot;;</div></pre></td></tr></table></figure></p>
<h2 id="局限性"><a href="#局限性" class="headerlink" title="局限性"></a>局限性</h2><p>字面量语法有个小小的限制，就是除了字符串以外，所创建出来的对象必须属于Foundation框架才行。如果自定义了这些类的子类，则无法用字面量语法创建其对象。要想创建自定义子类的实例，必须采用”非字面量语法“（nonliteral syntax）。然而，由于NSArray、NSDictionary、NSNumber都是业已定型的”子族“（class cluster，参见第9条），因此很少有人会从其中自定义子类，真要那样做也比较麻烦。而且一般来说，标准的实现已经很好了，无需再改动。创建字符串时可以使用自定义的子类，然而必须要修改编译器的选项才行。除非你明白这样做的后果，否则不鼓励使用此选项，用NSString就足够了。</p>
<p>使用字面量语法创建出来的字符串、数组、字典对象都是不可变的（immutable）。若想要可变版本的对象，则需复制一份：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSMutableArray *mutable = [@[@1,  @2,  @3,  @4, @5]mutableCopy];</div></pre></td></tr></table></figure></p>
<p>这么做会多调用一个方法，而且还要再创建一个对象，不过使用字面量语法所带来的好处还是多余上述缺点的。</p>
<h2 id="要点"><a href="#要点" class="headerlink" title="要点"></a>要点</h2><p>应该使用字面量语法来创建字符串、数值、数组、字典。与创建此类对象的常规方法相比，这么做更加简明扼要。<br>应该通过取下标操作来访问数组下标或字典中的键所对应的元素。<br>用字面量语法创建数组或字典时，若值中有nil，则会抛出异常。因此，务必确保值里不含nil。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://BreakMind.github.io/2017/03/02/第3条：多用字面量语法，少用与之等价的方法/" data-id="cizsoq1g7000oke6q7m3a9n77" class="article-share-link">分享</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/03/02/第4条：多用类型常量，少用-define预处理指令/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">新的</strong>
      <div class="article-nav-title">
        
          第4条：多用类型常量，少用#define预处理指令
        
      </div>
    </a>
  
  
    <a href="/2017/03/02/第2条：在类的头文件中尽量少引入其他都文件/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">旧的</strong>
      <div class="article-nav-title">第2条：在类的头文件中尽量少引入其他都文件</div>
    </a>
  
</nav>

  
</article>


  <section id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="post-第3条：多用字面量语法，少用与之等价的方法" data-title="第3条：多用字面量语法，少用与之等价的方法" data-url="http://BreakMind.github.io/2017/03/02/第3条：多用字面量语法，少用与之等价的方法/"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'breakmind'};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
    <!-- 多说公共JS代码 end -->
  </section>
  </section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/IOS/">IOS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/IOS-编写高质量代码/">IOS-编写高质量代码</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MAC/">MAC</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/吐槽/">吐槽</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/鉴古/">鉴古</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/03/02/第5条：用枚举表示状态、选项、状态码/">第5条：用枚举表示状态、选项、状态码</a>
          </li>
        
          <li>
            <a href="/2017/03/02/第4条：多用类型常量，少用-define预处理指令/">第4条：多用类型常量，少用#define预处理指令</a>
          </li>
        
          <li>
            <a href="/2017/03/02/第3条：多用字面量语法，少用与之等价的方法/">第3条：多用字面量语法，少用与之等价的方法</a>
          </li>
        
          <li>
            <a href="/2017/03/02/第2条：在类的头文件中尽量少引入其他都文件/">第2条：在类的头文件中尽量少引入其他都文件</a>
          </li>
        
          <li>
            <a href="/2017/03/02/第1条：熟悉Objective-C/">第1条-熟悉Objective-C</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">相关博客</h3>
    <div class="widget">
    <ul>
      <li><a href="http://ibireme.com" target="_blank">ibireme</a></li>
      <li><a href="http://blog.sunnyxx.com/" target="_blank">sunnyxx</a></li>
      <li><a href="http://github.ibireme.com/github/list/ios/" target="_blank">Github-iOS备忘</a></li>
      <li><a href="http://lysongzi.com/" target="_blank">lysongzZ_</a></li>
      <li><a href="http://blog.csdn.net/chenyufeng1991" target="_blank">乞力马扎罗的雪</a></li>
      <li><a href="http://www.shellsec.com/news/8114.html" target="_blank">BAT 面试指南</a></li>
      <li><a href="http://blog.csdn.net/yiyaaixuexi/" target="_blank">念茜</a></li>
      <li><a href="http://blog.txx.im/" target="_blank">TXX</a></li>
    </ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 BreakMind<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">主页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/" class="mobile-nav-link">个人简介</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>